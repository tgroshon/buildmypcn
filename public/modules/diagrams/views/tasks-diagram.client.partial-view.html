<div>
    <fieldset>
        <legend>Overall information</legend>
        <div class="form-group">
            <label class="col-md-2 control-label" for="diagram.metadata.title">Title</label>
            <div class="col-md-10">
                <input type="text" data-ng-model="diagram.metadata.title" id="diagram.metadata.title" class="form-control" placeholder="Title" aria-describedby="titleHelpBlock" required>
                <span id="titleHelpBlock" class="help-block">Choose a nice title for your amazing diagram</span>
            </div>
        </div>
        <div class="form-group" ng-show="groups.length">
            <label class="col-md-2 control-label" for="group">Group</label>
            <div class="col-sm-12 col-md-4">
                <select data-ng-model="selectedGroup" data-ng-options="group.name for group in groups" data-ng-required class="form-control"></select>
                <span id="titleHelpBlock" class="help-block">Everyone in your group will be able to edit the diagram</span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="diagram.metadata.description">Description</label>
            <div class="col-md-10">
                <textarea data-ng-model="diagram.metadata.description" id="diagram.metadata.description" class="form-control" placeholder="Description" required></textarea>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Domains</legend>
        <div data-ng-repeat="domain in diagram.domains" class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        {{ domain.subtitle || "Domain " + ($index + 1) }}&nbsp;&nbsp;
                        <button ng-click="editSubtitle$index=!editSubtitle$index" type="button" class="btn btn-default btn-xs">
                            <span class="glyphicon glyphicon-ok" ng-hide="editSubtitle$index" aria-hidden="true"></span>
                            <span class="glyphicon glyphicon-pencil" ng-show="editSubtitle$index" aria-hidden="true"></span>
                        </button>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="domain-title-{{$index}}">Name</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="domain-title-{{$index}}" name="domain-title-{{$index}}" data-ng-model="domain.title" placeholder="{{ domain.subtitle || 'Domain ' + ($index + 1) }} name" required>
                        </div>
                    </div>
                    <div class="form-group" data-ng-init="editSubtitle$index = true" data-collapse="editSubtitle$index">
                        <label class="col-md-2 control-label" for="domain-subtitle-{{$index}}">Title</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="domain-subtitle-{{$index}}" name="domain-subtitle-{{$index}}" data-ng-model="domain.subtitle" placeholder="Domain {{$index + 1}} title" required>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Steps</legend>
        <table class="table table-striped table-hover task-table" data-toggle="table">
            <tr>
                <th>Step #</th>
                <th>Title</th>
                <th>Region</th>
                <th>Options</th>
                <th>Predecessors</th>
                <th>Delete</th>
            </tr>
            <tr data-ng-repeat="step in diagram.steps">
                <td><span class="badge">{{$index + 1}}</span></td>
                <td>
                    <div class="input-group">
                        <div class="input-group-btn" data-dropdown data-is-open="domainDropdownStatus$index.isopen">
                            <button type="button" class="btn btn-default" data-dropdown-toggle>
                                <span>{{ getDomainFromId(step.domain.id) | domainTitle }}</span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li data-ng-repeat="domain in diagram.domains" ng-click="changeStepDomain(step, domain)"><a style="cursor: pointer">{{ getDomainFromId(domain.id) | domainTitle }}</a></li>
                            </ul>
                        </div>

                        <input type="text" class="form-control" id="step-title-{{$index}}" name="step-title-{{$index}}" data-ng-model="step.title" placeholder="needs pizza" required>
                    </div>
                </td>
                <td><select data-ng-model="step.selectedRegion" data-ng-change="updateStepRegions()" class="form-control" data-ng-options="region.displayName for region in regions"></select></td>
                <td>
                    <!-- Options dropdown -->
                    <div class="btn-group" data-dropdown data-is-open="stepOptionsDropdownStatus$index.isopen">
                        <button type="button" class="btn btn-warning" data-dropdown-toggle>Options <span class="caret"></span></button>
                        <ul class="dropdown-menu dropdown-menu-custom" role="menu">
                            <li data-ng-click="$event.stopPropagation();"><label class="checkbox-inline"><input type="checkbox" ng-model="step.emphasized"> Emphasized?</label></li>
                            <li class="divider"></li>
                            <li data-ng-click="$event.stopPropagation();">
                                <div class="btn-group btn-group-xs" role="group">
                                    <button type="button" class="btn btn-default" data-ng-repeat="valueGenericOption in valueGenericOptions" ng-click="setValueGeneric(step, valueGenericOption.name)">{{ valueGenericOption.displayName }}</button>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li data-ng-click="$event.stopPropagation();">
                                <div class="btn-group btn-group-xs" role="group">
                                    <button type="button" class="btn btn-default" data-ng-repeat="valueSpecificOption in valueSpecificOptions" ng-click="setValueSpecific(step, valueSpecificOption.name)">{{ valueSpecificOption.displayName }}</button>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li data-ng-click="$event.stopPropagation();">
                                <div class="btn-group">
                                    <label class="btn btn-primary" data-ng-repeat="stepType in stepTypes" data-ng-model="step.type" btn-radio="stepType.name">{{ stepType.displayedName }}</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </td>
                <td>
                     <select multiple data-ng-model="step.predecessors" id="step-predecessors-{{$index}}" class="form-control"><option data-ng-repeat="predecessor in diagram.steps" value="predecessor.id">{{predecessor.title}}</option></select>
                </td>
                <td><button type="button" class="btn btn-danger" data-ng-click="deleteStep($index)">&#10006</button></td>
            </tr>
        </table>
        <button type="button" class="btn btn-info" data-ng-click="addStep()">&#10010</button>
    </fieldset>
</div>
